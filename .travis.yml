sudo: required

services:
  - docker

env:
  global:
  - COMMIT=${TRAVIS_COMMIT::8}
  - secure: jdNgRndQT9SoTv/D0kE7/SeBt9sN/iWT4mEcpmuJiGmfSf8tiqlwyS7KezB6WqB+cdhMJCLi0Qk+9BdO0qy+Q5wysIsY9vOH2W8GQdP9hQ8aWX3lG7ZoUWKWO0LcEjoFmBqIg6mpTps0XV0bbDaRivuRw+frhHSai6OgsmTE6l0jiZBZXHglH6T8W6eGy/zyAMSJQpVI3rV9S0CERqSb2YjnZ2q28XJatklDB0QajIpstDjkypr/W2z+LEzV0o0Syoxtssadzu8ZC3SZOS/HS6u5yVEim5tt7c6p1SnGjGgXng4cTuy0ix95i/h3cI3PYNzz7JT/x33tmJlVqpgtsWq2Ue2Y14aTWOMtrHycJt1pQ0zSr9UpEjITNrLssqOF+T9xBQdGbmATAS3T+hBkeErhFC1zLz6viq13ULWJu3O0kcWusUEAdhuU6Yb9pL/tOGbDmgZ+NpH6lhNtuDxFw6mPX54Lh8QoiI0mAvy/RCxEPI0FSNMCGVQw/efzmJTbBpu0W7OokfyaoIrKl4OyOHIfRulFMMCAarha0qM/GJtiM0foJ40rlwyclu0rd0MW0CWGpyhCjO3H/MBHwMd9J7sUmByh1HLNK8xmtJGHKGQL0Yl4f9iajSHTzZCEwPcrE1doVY8hcegP78z0jnYHodPvmmCSA3w2IgI5sg29UkE=
  - secure: I5OUcJlt2/nUEy10WaRbBc6GF64a8ueFaukA5/jza9LsSJ5NK7ZsRQ79U3S//h/gp3jv4akIfJGCxfVwN/vnDevsUCdcV8NmViI1aAN0mAuPDJUlFU3+1OSxEpqMAG7JyhrYKM5m5K+0PPuRJpL5NVfGFnUUm/RzvoCDNM/2aGGiG8e+p7BBiYRngCPiwR2vNLhiD/NJt9C4QMCZ8hpmVD1+EQbgezfsZvlF7KZCY6J7QFF9kRCfk/+ge4Ky3bAmrXiOKW756sD705IUjkF+BUb+tFHaTEAm12nVPSi+eyixunPtWjDxse9TKRF3qWt/qXadKk30bgqK4pdjX3q+iC9w5agZ1SUH5Lv/mbjAdznDM9j/vk6yJ9ahjG2ZJbDbeeVQoB989AUfOSV7POOHRhPCkpebyk3F6RDraptlZH4D1JhmQepveEn9qouzzxEVJqa8tNxmC+csf179WOlgoMcaVyQfzcDek4PYbBac8B2RGFNbc9zh7D1jwWzSX5yHHymfQVLGQEXZbD8aEF6P9AX1m7OIJIQbxodTrXQj1Xdw29jaAO3S7JfKSQUAveE12mVZpwfetEZ60/V/uU190ygy004hqTPep0EXoa7pUthkw/MBf+l3ldn455iMzK7/09Mh9ug95qkIXwTeppESP9P23abiQDB0Ybv1kf34xTw=
  - secure: XKak3jHZ3pMI7EbKrF6OmAczhKqRdQLES7QRxMUdz8ESAHWNbuEgP7LZQme2AY8APQDIdTp1mgwp24D8j1F6hQaEwCe++hd55nJDItJh9kHoy2hrJlYLixgaiiJKvkzkzKJ3w8mD0jDAqfsd1fkN/BPeWdDu5hpElOeqLQY1uW2TZKrKMtmDr3YhrXVVCojLabyu9wmnFqLOzbDo5jqiDpuBEltRRG15Fo/hyxz4bbfnaecBT9PuvymA9lF/cdYxizcYjRRN82v9xkmKpVTLmwR6XFyOb+2gp1G+ubMQY1B14QHU+39PDdKYwnIHcaZl+w47YrwOa2XOM4GsA8xWUMkel3osJqpwJIs5dzEISX6FQdJjFiQcsrMIk+MXA7Czm1oLnmFT2YmqdyW4meOns+AuLhP3WhwsUeKby7ZteIvA20fwhnI2kH2rle2yAeeoZf4tnBbDOrBunG0Lz5hhCzCx/pdz6otsWhfmLW0CRG6hyePSNXQCki468H7UbmSJqW/KQQcWwUCP8yEoe23RIA3DIDsBxiFmkirIeEOmxeFQIaiMN96M0sBjrIlba2Hdvkw2xNTEKeRPE4kTXB60VZXhSpmyjVaPicyZ71GiHHeo89HfUZiQUax/mlancK8ZJg13MTfgJFtFZEm+2vzqs9HZH4xlChuCqtwe7O1uEWg=

after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASSWORD
- export REPO=stefan125/sofia-context-service
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
- docker build -f service-context/Dockerfile -t $REPO:$COMMIT .
- docker tag $REPO:$COMMIT $REPO:$TAG
- docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
- docker push $REPO
